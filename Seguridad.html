<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Seguridad y Alta Disponibilidad - Sistema de Evaluaci√≥n Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            font-size: 16px;
        }

        .container {
            width: 100%;
            max-width: 100%;
            height: 100vh;
            margin: 0;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }

        @media (min-width: 768px) {
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 0;
            }
            .container {
                max-width: 900px;
                height: 100vh;
                border-radius: 0;
                box-shadow: 0 0 60px rgba(0,0,0,0.3);
            }
        }

        @media (min-width: 1024px) {
            body { padding: 20px; }
            .container {
                height: calc(100vh - 40px);
                border-radius: 20px;
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .header h1 { font-size: 1.5em; margin-bottom: 8px; }
        @media (min-width: 480px) { .header h1 { font-size: 2em; } }
        @media (min-width: 768px) { .header h1 { font-size: 2.5em; } }

        .progress-container {
            background: rgba(255,255,255,0.2);
            height: 22px;
            border-radius: 15px;
            margin-top: 12px;
            overflow: hidden;
        }

        .progress-bar {
            background: white;
            height: 100%;
            border-radius: 15px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #667eea;
            font-size: 0.8em;
        }

        .mode-selection {
            padding: 20px 15px;
            text-align: center;
            min-height: calc(100vh - 120px);
        }

        .modes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .mode-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            touch-action: manipulation;
        }

        .mode-card:hover { border-color: #667eea; transform: translateY(-2px); }
        .mode-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .mode-icon { font-size: 2em; margin-bottom: 8px; }
        .mode-title { font-size: 1.1em; font-weight: bold; }
        .mode-description { font-size: 0.8em; opacity: 0.9; }

        .quiz-container { padding: 20px 15px; display: none; }
        .quiz-container.active { display: block; animation: slideIn 0.5s ease; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            min-height: 50px;
            touch-action: manipulation;
        }

        .option.selected { background: #667eea; color: white; }
        .option.correct { background: #28a745; color: white; }
        .option.incorrect { background: #dc3545; color: white; }
        .option.disabled { cursor: not-allowed; opacity: 0.8; }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            width: 100%;
            min-height: 48px;
            touch-action: manipulation;
        }

        .btn-primary { background: #667eea; color: white; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }
        .feedback.show { display: block; }
        .feedback.correct { background: #d4edda; border: 1px solid #28a745; }
        .feedback.incorrect { background: #f8d7da; border: 1px solid #dc3545; }

        .results-screen { padding: 20px; display: none; text-align: center; }
        .back-to-menu {
            position: fixed; top: 10px; left: 10px;
            background: white; border-radius: 50%;
            width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            z-index: 100; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .hidden { display: none; }

        /* Estilos adicionales para resultados */
        .results-circle {
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }

        .score-circle {
            fill: none;
            stroke: #e9ecef;
            stroke-width: 10;
        }

        .score-progress {
            fill: none;
            stroke: #667eea;
            stroke-width: 10;
            stroke-linecap: round;
            stroke-dasharray: 565;
            stroke-dashoffset: 565;
            transition: stroke-dashoffset 2s ease;
            transform: rotate(-90deg);
            transform-origin: center;
        }

        .score-text {
            font-size: 3em;
            font-weight: bold;
            fill: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        .topic-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            margin: 5px 0;
            border-radius: 8px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 15px;
            margin: 5px 0;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .result-item.correct { background: #d4edda; }
        .result-item.incorrect { background: #f8d7da; }

        /* Indicador de guardado autom√°tico */
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            display: none;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
    </style>
</head>

<body>
    <div class="back-to-menu hidden" id="backToMenu" onclick="returnToMenu()" aria-label="Volver al men√∫">‚¨ÖÔ∏è</div>
    <div class="save-indicator" id="saveIndicator">‚úì Progreso guardado</div>

    <div class="container">
        <div class="header">
            <h1>Seguridad y Alta Disponibilidad</h1>
            <p>Sistema de Evaluaci√≥n Completo</p>
            <div class="progress-container" style="display: none;" id="progressContainer">
                <div class="progress-bar" id="progressBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
            </div>
        </div>

        <div class="mode-selection" id="modeSelection">
            <h2>Selecciona el Modo de Pr√°ctica</h2>
            <div class="modes-grid">
                <div class="mode-card" onclick="selectMode('ut1')" id="modeUT1" role="button" aria-label="Seleccionar UT-1 Fundamentos">
                    <div class="mode-icon">üõ°Ô∏è</div>
                    <div class="mode-title">UT-1: Fundamentos</div>
                    <div class="mode-description">Seguridad f√≠sica, l√≥gica, tr√≠ada CID y criptograf√≠a b√°sica.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut2')" id="modeUT2" role="button" aria-label="Seleccionar UT-2 Amenazas">
                    <div class="mode-icon">üïµÔ∏è</div>
                    <div class="mode-title">UT-2: Amenazas</div>
                    <div class="mode-description">Malware, Cyber Kill Chain y an√°lisis de red.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut3')" id="modeUT3" role="button" aria-label="Seleccionar UT-3 Accesos">
                    <div class="mode-icon">üîë</div>
                    <div class="mode-title">UT-3: Accesos</div>
                    <div class="mode-description">VPN, SSH, RADIUS y bastiones.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut4')" id="modeUT4" role="button" aria-label="Seleccionar UT-4 Copias de Seguridad">
                    <div class="mode-icon">üíæ</div>
                    <div class="mode-title">UT-4: Copias de Seguridad</div>
                    <div class="mode-description">Backup, restauraci√≥n y continuidad del negocio.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut5')" id="modeUT5" role="button" aria-label="Seleccionar UT-5 Cortafuegos">
                    <div class="mode-icon">üî•</div>
                    <div class="mode-title">UT-5: Cortafuegos</div>
                    <div class="mode-description">Firewalls, DMZ, IDS/IPS y pfSense.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut6')" id="modeUT6" role="button" aria-label="Seleccionar UT-6 Proxies">
                    <div class="mode-icon">üîÑ</div>
                    <div class="mode-title">UT-6: Proxies</div>
                    <div class="mode-description">Proxy HTTP/HTTPS, Squid, cach√© y filtrado web.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut7')" id="modeUT7" role="button" aria-label="Seleccionar UT-7 Alta Disponibilidad">
                    <div class="mode-icon">‚ö°</div>
                    <div class="mode-title">UT-7: Alta Disponibilidad</div>
                    <div class="mode-description">Clustering, balanceo de carga, failover y redundancia.</div>
                </div>
                <div class="mode-card" onclick="selectMode('mixed')" id="modeMixed" role="button" aria-label="Seleccionar modo mixto">
                    <div class="mode-icon">üé≤</div>
                    <div class="mode-title">Modo Mixto</div>
                    <div class="mode-description">Preguntas aleatorias de todas las unidades.</div>
                </div>
            </div>
            <button class="btn btn-primary" id="startBtn" onclick="startQuiz()" disabled aria-label="Iniciar test">Iniciar Test</button>
        </div>

        <div class="quiz-container" id="quizContainer">
            <div class="question-header">
                <h2 id="questionNumber">Pregunta 1</h2>
                <span id="questionTopic" style="color: #6c757d; font-size: 0.9em;"></span>
            </div>
            <p id="questionText" style="margin: 20px 0; font-size: 1.1em;"></p>
            <div id="optionsContainer"></div>
            <div class="feedback" id="feedback"></div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" id="prevBtn" onclick="previousQuestion()" style="width: 48%;" aria-label="Pregunta anterior">Anterior</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" style="width: 48%;" aria-label="Siguiente pregunta">Siguiente</button>
            </div>
        </div>

        <div class="results-screen" id="resultsScreen">
            <h2>Resultados del Test</h2>
            <svg class="results-circle">
                <circle cx="100" cy="100" r="90" class="score-circle"></circle>
                <circle cx="100" cy="100" r="90" class="score-progress" id="scoreProgress"></circle>
                <text x="100" y="110" text-anchor="middle" class="score-text" id="scoreText">0%</text>
            </svg>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="correctCount">0</div>
                    <div class="stat-label">Correctas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="incorrectCount">0</div>
                    <div class="stat-label">Incorrectas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalQuestions">0</div>
                    <div class="stat-label">Total</div>
                </div>
            </div>

            <div id="topicStats" style="margin: 20px 0;"></div>
            <div id="resultsDetails" style="margin: 20px 0;"></div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="restartSameMode()" style="width: 48%;">Repetir Test</button>
                <button class="btn btn-primary" onclick="returnToMenu()" style="width: 48%;">Volver al Men√∫</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentMode = null;
        let currentQuestions = [];
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = [];
        let answered = false;
        let topicScores = {};

        // Base de preguntas por unidad tem√°tica
        const ut1Questions = [
            {
                question: "¬øCu√°les son los tres pilares fundamentales de la seguridad de la informaci√≥n (tr√≠ada CID)?",
                options: [
                    "Confidencialidad, Integridad, Disponibilidad",
                    "Control, Identificaci√≥n, Defensa",
                    "Cifrado, Identidad, Datos",
                    "Conexi√≥n, Internet, Dispositivos"
                ],
                correct: 0,
                explanation: "La tr√≠ada CID representa Confidencialidad (solo usuarios autorizados acceden), Integridad (datos sin alteraci√≥n) y Disponibilidad (acceso cuando se necesita).",
                topic: "UT-1: Fundamentos"
            },
            {
                question: "¬øQu√© tipo de seguridad protege los equipos f√≠sicos y las instalaciones?",
                options: [
                    "Seguridad l√≥gica",
                    "Seguridad f√≠sica",
                    "Seguridad perimetral",
                    "Seguridad de red"
                ],
                correct: 1,
                explanation: "La seguridad f√≠sica protege el hardware, las instalaciones y el personal contra amenazas f√≠sicas como robo, incendio o acceso no autorizado.",
                topic: "UT-1: Fundamentos"
            },
            {
                question: "¬øQu√© algoritmo de cifrado sim√©trico es considerado el est√°ndar actual?",
                options: [
                    "DES",
                    "RSA",
                    "AES",
                    "MD5"
                ],
                correct: 2,
                explanation: "AES (Advanced Encryption Standard) es el algoritmo de cifrado sim√©trico est√°ndar actual, con claves de 128, 192 o 256 bits.",
                topic: "UT-1: Fundamentos"
            },
            {
                question: "¬øCu√°l es la principal diferencia entre cifrado sim√©trico y asim√©trico?",
                options: [
                    "El sim√©trico es m√°s seguro",
                    "El asim√©trico usa la misma clave para cifrar y descifrar",
                    "El sim√©trico usa una clave, el asim√©trico usa un par de claves",
                    "El asim√©trico es m√°s r√°pido"
                ],
                correct: 2,
                explanation: "El cifrado sim√©trico usa una sola clave compartida, mientras que el asim√©trico utiliza un par de claves (p√∫blica y privada).",
                topic: "UT-1: Fundamentos"
            },
            {
                question: "¬øQu√© funci√≥n criptogr√°fica garantiza la integridad de los datos?",
                options: [
                    "Cifrado sim√©trico",
                    "Firma digital",
                    "Hash",
                    "Certificado digital"
                ],
                correct: 2,
                explanation: "Las funciones hash generan un resumen √∫nico de los datos que permite detectar cualquier modificaci√≥n.",
                topic: "UT-1: Fundamentos"
            }
        ];

        const ut2Questions = [
            {
                question: "¬øQu√© tipo de malware se replica a s√≠ mismo sin necesidad de un archivo hu√©sped?",
                options: [
                    "Virus",
                    "Gusano",
                    "Troyano",
                    "Spyware"
                ],
                correct: 1,
                explanation: "Los gusanos son malware autorreplicantes que se propagan por la red sin necesitar un archivo hu√©sped, a diferencia de los virus.",
                topic: "UT-2: Amenazas"
            },
            {
                question: "¬øCu√°l es la primera fase del Cyber Kill Chain?",
                options: [
                    "Weaponizaci√≥n",
                    "Explotaci√≥n",
                    "Reconocimiento",
                    "Instalaci√≥n"
                ],
                correct: 2,
                explanation: "El reconocimiento es la primera fase donde el atacante recopila informaci√≥n sobre el objetivo antes de planificar el ataque.",
                topic: "UT-2: Amenazas"
            },
            {
                question: "¬øQu√© tipo de ataque intenta hacer que un servicio no est√© disponible?",
                options: [
                    "Phishing",
                    "Man-in-the-middle",
                    "DDoS",
                    "SQL Injection"
                ],
                correct: 2,
                explanation: "Los ataques DDoS (Distributed Denial of Service) buscan saturar un servicio para hacerlo inaccesible a usuarios leg√≠timos.",
                topic: "UT-2: Amenazas"
            },
            {
                question: "¬øQu√© herramienta se utiliza com√∫nmente para an√°lisis de tr√°fico de red?",
                options: [
                    "Nmap",
                    "Metasploit",
                    "Wireshark",
                    "John the Ripper"
                ],
                correct: 2,
                explanation: "Wireshark es un analizador de protocolos de red que permite capturar y examinar el tr√°fico en tiempo real.",
                topic: "UT-2: Amenazas"
            },
            {
                question: "¬øQu√© tipo de malware cifra los archivos y pide un rescate?",
                options: [
                    "Adware",
                    "Ransomware",
                    "Rootkit",
                    "Keylogger"
                ],
                correct: 1,
                explanation: "El ransomware cifra los archivos del sistema y exige un pago (rescate) para recuperar el acceso a los datos.",
                topic: "UT-2: Amenazas"
            }
        ];

        const ut3Questions = [
            {
                question: "¬øQu√© protocolo VPN opera en la capa 3 del modelo OSI?",
                options: [
                    "PPTP",
                    "L2TP",
                    "IPSec",
                    "SSL/TLS"
                ],
                correct: 2,
                explanation: "IPSec opera en la capa 3 (red) del modelo OSI, proporcionando seguridad a nivel de paquetes IP.",
                topic: "UT-3: Accesos"
            },
            {
                question: "¬øQu√© puerto utiliza SSH por defecto?",
                options: [
                    "21",
                    "22",
                    "23",
                    "25"
                ],
                correct: 1,
                explanation: "SSH (Secure Shell) utiliza el puerto 22 por defecto para conexiones seguras de administraci√≥n remota.",
                topic: "UT-3: Accesos"
            },
            {
                question: "¬øQu√© protocolo AAA es m√°s completo y moderno?",
                options: [
                    "RADIUS",
                    "TACACS+",
                    "Kerberos",
                    "LDAP"
                ],
                correct: 1,
                explanation: "TACACS+ separa autenticaci√≥n, autorizaci√≥n y contabilidad, ofreciendo m√°s granularidad que RADIUS.",
                topic: "UT-3: Accesos"
            },
            {
                question: "¬øQu√© es un bastion host?",
                options: [
                    "Un servidor de respaldo",
                    "Un servidor expuesto que act√∫a como punto de entrada seguro",
                    "Un tipo de firewall",
                    "Un sistema de detecci√≥n de intrusos"
                ],
                correct: 1,
                explanation: "Un bastion host es un servidor fortificado que sirve como √∫nico punto de entrada a una red interna desde Internet.",
                topic: "UT-3: Accesos"
            },
            {
                question: "¬øQu√© m√©todo de autenticaci√≥n es considerado m√°s seguro?",
                options: [
                    "Contrase√±a simple",
                    "Autenticaci√≥n de dos factores",
                    "Pregunta de seguridad",
                    "PIN de 4 d√≠gitos"
                ],
                correct: 1,
                explanation: "La autenticaci√≥n de dos factores (2FA) combina algo que sabes con algo que tienes o eres, aumentando significativamente la seguridad.",
                topic: "UT-3: Accesos"
            }
        ];

        const ut4Questions = [
            {
                question: "¬øQu√© tipo de backup copia todos los datos independientemente de cambios previos?",
                options: [
                    "Incremental",
                    "Diferencial",
                    "Completo",
                    "Espejo"
                ],
                correct: 2,
                explanation: "El backup completo (full) copia todos los datos seleccionados, sin importar si han cambiado o no desde el √∫ltimo backup.",
                topic: "UT-4: Copias de Seguridad"
            },
            {
                question: "¬øCu√°l es la regla 3-2-1 de backups?",
                options: [
                    "3 copias, 2 ubicaciones, 1 prueba mensual",
                    "3 copias, 2 medios diferentes, 1 copia offsite",
                    "3 d√≠as de retenci√≥n, 2 verificaciones, 1 responsable",
                    "3 servidores, 2 redes, 1 datacenter"
                ],
                correct: 1,
                explanation: "La regla 3-2-1 establece: 3 copias totales de los datos, en 2 tipos de medios diferentes, con 1 copia fuera del sitio.",
                topic: "UT-4: Copias de Seguridad"
            },
            {
                question: "¬øQu√© es el RTO (Recovery Time Objective)?",
                options: [
                    "Cantidad m√°xima de datos que se pueden perder",
                    "Tiempo m√°ximo aceptable de interrupci√≥n del servicio",
                    "Frecuencia de realizaci√≥n de backups",
                    "Tiempo de retenci√≥n de las copias"
                ],
                correct: 1,
                explanation: "El RTO define el tiempo m√°ximo aceptable que un sistema puede estar fuera de servicio despu√©s de un incidente.",
                topic: "UT-4: Copias de Seguridad"
            },
            {
                question: "¬øQu√© tipo de backup solo copia los datos modificados desde el √∫ltimo backup completo?",
                options: [
                    "Incremental",
                    "Diferencial",
                    "Sint√©tico",
                    "Progresivo"
                ],
                correct: 1,
                explanation: "El backup diferencial copia todos los datos modificados desde el √∫ltimo backup completo, acumulando cambios.",
                topic: "UT-4: Copias de Seguridad"
            },
            {
                question: "¬øQu√© tecnolog√≠a permite crear copias instant√°neas del estado de un sistema?",
                options: [
                    "Clonaci√≥n",
                    "Snapshot",
                    "Mirror",
                    "Archive"
                ],
                correct: 1,
                explanation: "Los snapshots crean una imagen instant√°nea del estado del sistema en un momento espec√≠fico, √∫til para recuperaci√≥n r√°pida.",
                topic: "UT-4: Copias de Seguridad"
            }
        ];

        const ut5Questions = [
            {
                question: "¬øQu√© tipo de firewall inspecciona el estado de las conexiones?",
                options: [
                    "Packet filtering",
                    "Proxy",
                    "Stateful",
                    "Application"
                ],
                correct: 2,
                explanation: "Los firewalls stateful mantienen una tabla de estado de las conexiones, permitiendo un filtrado m√°s inteligente del tr√°fico.",
                topic: "UT-5: Cortafuegos"
            },
            {
                question: "¬øQu√© es una DMZ en seguridad de redes?",
                options: [
                    "Una zona de alta seguridad",
                    "Una zona intermedia entre la red interna e Internet",
                    "Un tipo de VPN",
                    "Un protocolo de seguridad"
                ],
                correct: 1,
                explanation: "La DMZ (Zona Desmilitarizada) es una red perimetral que a√±ade una capa de seguridad entre Internet y la red interna.",
                topic: "UT-5: Cortafuegos"
            },
            {
                question: "¬øCu√°l es la diferencia principal entre IDS e IPS?",
                options: [
                    "IDS es m√°s r√°pido",
                    "IPS solo detecta, IDS bloquea",
                    "IDS solo detecta, IPS detecta y bloquea",
                    "No hay diferencia"
                ],
                correct: 2,
                explanation: "IDS (Intrusion Detection System) solo detecta y alerta, mientras que IPS (Intrusion Prevention System) puede bloquear activamente las amenazas.",
                topic: "UT-5: Cortafuegos"
            },
            {
                question: "¬øQu√© puerto debe estar abierto para permitir tr√°fico HTTPS?",
                options: [
                    "80",
                    "443",
                    "8080",
                    "8443"
                ],
                correct: 1,
                explanation: "HTTPS utiliza el puerto 443 por defecto para comunicaciones web seguras con cifrado SSL/TLS.",
                topic: "UT-5: Cortafuegos"
            },
            {
                question: "¬øQu√© t√©cnica usa pfSense para balancear la carga entre m√∫ltiples enlaces WAN?",
                options: [
                    "NAT",
                    "Multi-WAN",
                    "VLAN",
                    "Bridge"
                ],
                correct: 1,
                explanation: "pfSense utiliza Multi-WAN para distribuir el tr√°fico entre m√∫ltiples conexiones a Internet, proporcionando balanceo de carga y failover.",
                topic: "UT-5: Cortafuegos"
            }
        ];

        const ut6Questions = [
            {
                question: "¬øCu√°l es la funci√≥n principal de un proxy HTTP?",
                options: [
                    "Cifrar todo el tr√°fico de red",
                    "Actuar como intermediario entre clientes y servidores web",
                    "Bloquear todos los virus",
                    "Reemplazar el firewall"
                ],
                correct: 1,
                explanation: "Un proxy HTTP act√∫a como intermediario entre los clientes y los servidores web, pudiendo cachear contenido, filtrar y registrar el tr√°fico.",
                topic: "UT-6: Proxies"
            },
            {
                question: "¬øQu√© puerto utiliza Squid por defecto?",
                options: [
                    "8080",
                    "3128",
                    "8888",
                    "1080"
                ],
                correct: 1,
                explanation: "Squid utiliza el puerto 3128 por defecto para las conexiones de proxy HTTP.",
                topic: "UT-6: Proxies"
            },
            {
                question: "¬øQu√© tipo de proxy no requiere configuraci√≥n en el cliente?",
                options: [
                    "Proxy expl√≠cito",
                    "Proxy SOCKS",
                    "Proxy transparente",
                    "Proxy inverso"
                ],
                correct: 2,
                explanation: "El proxy transparente intercepta el tr√°fico sin necesidad de configuraci√≥n en el cliente, funcionando de forma invisible.",
                topic: "UT-6: Proxies"
            },
            {
                question: "¬øQu√© es un proxy inverso (reverse proxy)?",
                options: [
                    "Un proxy que bloquea todo el tr√°fico",
                    "Un proxy que se sit√∫a delante de los servidores web",
                    "Un proxy que invierte las direcciones IP",
                    "Un proxy que funciona al rev√©s"
                ],
                correct: 1,
                explanation: "Un proxy inverso se sit√∫a delante de uno o m√°s servidores web, distribuyendo las peticiones y ocultando la infraestructura interna.",
                topic: "UT-6: Proxies"
            },
            {
                question: "¬øQu√© ventaja ofrece la cach√© de un proxy?",
                options: [
                    "Mayor seguridad",
                    "Reducci√≥n del ancho de banda y mejora de velocidad",
                    "Cifrado de datos",
                    "Bloqueo de malware"
                ],
                correct: 1,
                explanation: "La cach√© del proxy almacena contenido frecuentemente solicitado, reduciendo el uso de ancho de banda y mejorando la velocidad de acceso.",
                topic: "UT-6: Proxies"
            }
        ];

        const ut7Questions = [
            {
                question: "¬øQu√© es la alta disponibilidad (HA)?",
                options: [
                    "Tener servidores muy r√°pidos",
                    "Capacidad de un sistema para operar continuamente sin fallos",
                    "Tener muchos usuarios conectados",
                    "Usar la √∫ltima tecnolog√≠a"
                ],
                correct: 1,
                explanation: "La alta disponibilidad es la capacidad de un sistema para mantenerse operativo durante un alto porcentaje del tiempo, minimizando las interrupciones.",
                topic: "UT-7: Alta Disponibilidad"
            },
            {
                question: "¬øQu√© significa un SLA del 99.9%?",
                options: [
                    "Tiempo de inactividad m√°ximo de 8.76 horas al a√±o",
                    "Tiempo de inactividad m√°ximo de 1 hora al a√±o",
                    "Tiempo de inactividad m√°ximo de 24 horas al a√±o",
                    "Tiempo de inactividad m√°ximo de 1 minuto al a√±o"
                ],
                correct: 0,
                explanation: "Un SLA del 99.9% (tres nueves) permite un tiempo de inactividad m√°ximo de aproximadamente 8.76 horas al a√±o.",
                topic: "UT-7: Alta Disponibilidad"
            },
            {
                question: "¬øQu√© es un cl√∫ster activo-pasivo?",
                options: [
                    "Todos los nodos procesan tr√°fico simult√°neamente",
                    "Un nodo activo procesa mientras otros esperan en standby",
                    "Los nodos se activan por la noche",
                    "Los nodos trabajan en diferentes ubicaciones"
                ],
                correct: 1,
                explanation: "En un cl√∫ster activo-pasivo, un nodo maneja todo el tr√°fico mientras los otros permanecen en espera, listos para tomar el control si falla el activo.",
                topic: "UT-7: Alta Disponibilidad"
            },
            {
                question: "¬øQu√© protocolo se usa com√∫nmente para detectar fallos en alta disponibilidad?",
                options: [
                    "HTTP",
                    "FTP",
                    "Heartbeat/VRRP",
                    "SMTP"
                ],
                correct: 2,
                explanation: "Protocolos como Heartbeat o VRRP (Virtual Router Redundancy Protocol) se utilizan para detectar fallos y realizar failover autom√°tico.",
                topic: "UT-7: Alta Disponibilidad"
            },
            {
                question: "¬øQu√© es el balanceo de carga?",
                options: [
                    "Dividir archivos en partes iguales",
                    "Distribuir el tr√°fico entre m√∫ltiples servidores",
                    "Reducir el peso de los servidores",
                    "Equilibrar el consumo el√©ctrico"
                ],
                correct: 1,
                explanation: "El balanceo de carga distribuye las peticiones entrantes entre m√∫ltiples servidores para optimizar el rendimiento y evitar sobrecarga.",
                topic: "UT-7: Alta Disponibilidad"
            }
        ];

        // Funci√≥n para mezclar arrays
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Seleccionar modo
        function selectMode(mode) {
            // Remover selecci√≥n previa
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Marcar modo seleccionado
            const modeCard = document.getElementById('mode' + mode.toUpperCase());
            if (modeCard) {
                modeCard.classList.add('selected');
            }

            currentMode = mode;
            document.getElementById('startBtn').disabled = false;

            // Guardar selecci√≥n en localStorage
            localStorage.setItem('lastSelectedMode', mode);
        }

        // Iniciar quiz
        function startQuiz() {
            if (!currentMode) return;

            // Resetear variables
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            answered = false;
            topicScores = {};

            // Seleccionar preguntas seg√∫n el modo
            switch(currentMode) {
                case 'ut1':
                    currentQuestions = shuffleArray(ut1Questions);
                    break;
                case 'ut2':
                    currentQuestions = shuffleArray(ut2Questions);
                    break;
                case 'ut3':
                    currentQuestions = shuffleArray(ut3Questions);
                    break;
                case 'ut4':
                    currentQuestions = shuffleArray(ut4Questions);
                    break;
                case 'ut5':
                    currentQuestions = shuffleArray(ut5Questions);
                    break;
                case 'ut6':
                    currentQuestions = shuffleArray(ut6Questions);
                    break;
                case 'ut7':
                    currentQuestions = shuffleArray(ut7Questions);
                    break;
                case 'mixed':
                    const allQuestions = [
                        ...ut1Questions,
                        ...ut2Questions,
                        ...ut3Questions,
                        ...ut4Questions,
                        ...ut5Questions,
                        ...ut6Questions,
                        ...ut7Questions
                    ];
                    currentQuestions = shuffleArray(allQuestions).slice(0, 25);
                    break;
            }

            // Mostrar quiz
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('quizContainer').classList.add('active');
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('backToMenu').classList.remove('hidden');

            // Cargar primera pregunta
            loadQuestion();
            updateProgressBar();

            // Guardar estado
            saveProgress();
        }

        // Cargar pregunta
        function loadQuestion() {
            answered = userAnswers[currentQuestion] !== undefined;
            const q = currentQuestions[currentQuestion];

            document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestion + 1} de ${currentQuestions.length}`;
            document.getElementById('questionTopic').textContent = q.topic;
            document.getElementById('questionText').textContent = q.question;

            // Cargar opciones
            const optionsHTML = q.options.map((option, index) => {
                const isSelected = userAnswers[currentQuestion] === index;
                const isCorrect = index === q.correct;
                let className = 'option';
                
                if (answered) {
                    className += ' disabled';
                    if (isSelected) className += ' selected';
                    if (isSelected && !isCorrect) className += ' incorrect';
                    if (isCorrect) className += ' correct';
                }

                return `<div class="${className}" onclick="selectOption(${index})" aria-label="Opci√≥n ${index + 1}">${option}</div>`;
            }).join('');

            document.getElementById('optionsContainer').innerHTML = optionsHTML;

            // Mostrar feedback si ya fue respondida
            if (answered) {
                showFeedback(userAnswers[currentQuestion] === q.correct);
            } else {
                document.getElementById('feedback').classList.remove('show');
            }

            updateButtons();
        }

        // Seleccionar opci√≥n
        function selectOption(index) {
            if (answered) return;

            userAnswers[currentQuestion] = index;
            answered = true;

            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.add('disabled'));
            options[index].classList.add('selected');

            const correct = currentQuestions[currentQuestion].correct;
            const topic = currentQuestions[currentQuestion].topic;

            // Actualizar estad√≠sticas por tema
            if (!topicScores[topic]) {
                topicScores[topic] = { correct: 0, total: 0 };
            }
            topicScores[topic].total++;

            if (index === correct) {
                options[index].classList.add('correct');
                score++;
                topicScores[topic].correct++;
                showFeedback(true);
            } else {
                options[index].classList.add('incorrect');
                options[correct].classList.add('correct');
                showFeedback(false);
            }

            updateButtons();
            saveProgress();
        }

        // Mostrar feedback
        function showFeedback(isCorrect) {
            const feedback = document.getElementById('feedback');
            feedback.className = `feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.innerHTML = `
                <strong>${isCorrect ? '‚úÖ ¬°Correcto!' : '‚ùå Incorrecto'}</strong><br>
                ${currentQuestions[currentQuestion].explanation}
            `;
        }

        // Navegar a pregunta anterior
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
                updateProgressBar();
            }
        }

        // Navegar a siguiente pregunta
        function nextQuestion() {
            if (currentQuestion < currentQuestions.length - 1) {
                currentQuestion++;
                loadQuestion();
                updateProgressBar();
            } else if (userAnswers.length === currentQuestions.length) {
                showResults();
            }
        }

        // Actualizar botones
        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            prevBtn.disabled = currentQuestion === 0;

            if (currentQuestion === currentQuestions.length - 1) {
                if (userAnswers.length === currentQuestions.length) {
                    nextBtn.textContent = 'Ver Resultados';
                    nextBtn.disabled = false;
                } else {
                    nextBtn.textContent = 'Siguiente';
                    nextBtn.disabled = !answered;
                }
            } else {
                nextBtn.textContent = 'Siguiente';
                nextBtn.disabled = !answered;
            }
        }

        // Actualizar barra de progreso
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / currentQuestions.length) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
            progressBar.setAttribute('aria-valuenow', Math.round(progress));
        }

        // Mostrar resultados
        function showResults() {
            document.getElementById('quizContainer').classList.remove('active');
            document.getElementById('resultsScreen').style.display = 'block';
            document.getElementById('progressContainer').style.display = 'none';

            const percentage = Math.round((score / currentQuestions.length) * 100);
            const scoreText = document.getElementById('scoreText');
            const scoreProgress = document.getElementById('scoreProgress');
            const correctCount = document.getElementById('correctCount');
            const incorrectCount = document.getElementById('incorrectCount');
            const totalQuestions = document.getElementById('totalQuestions');

            scoreText.textContent = percentage + '%';
            correctCount.textContent = score;
            incorrectCount.textContent = currentQuestions.length - score;
            totalQuestions.textContent = currentQuestions.length;

            // Animaci√≥n del c√≠rculo de progreso
            setTimeout(() => {
                const offset = 565 - (565 * percentage / 100);
                scoreProgress.style.strokeDashoffset = offset;
            }, 100);

            // Mostrar estad√≠sticas por tema
            const topicStatsDiv = document.getElementById('topicStats');
            let topicHTML = '<h3>Rendimiento por Tema</h3>';

            for (const [topic, stats] of Object.entries(topicScores)) {
                const topicPercentage = Math.round((stats.correct / stats.total) * 100);
                topicHTML += `
                    <div class="topic-stat">
                        <span>${topic}</span>
                        <span>${stats.correct}/${stats.total} (${topicPercentage}%)</span>
                    </div>
                `;
            }

            topicStatsDiv.innerHTML = topicHTML;

            // Mostrar detalles
            const details = document.getElementById('resultsDetails');
            let detailsHTML = '<h3>Resumen de Respuestas</h3>';

            currentQuestions.forEach((q, index) => {
                const isCorrect = userAnswers[index] === q.correct;
                detailsHTML += `
                    <div class="result-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <span>Pregunta ${index + 1}</span>
                        <span>${isCorrect ? '‚úÖ Correcta' : '‚ùå Incorrecta'}</span>
                    </div>
                `;
            });

            details.innerHTML = detailsHTML;

            // Mensaje seg√∫n el resultado - CORREGIDO
            let message = '';
            if (percentage >= 90) {
                message = '<p style="margin-top: 20px; font-size: 1.1em; color: #28a745;">¬°Excelente! Dominas los conceptos de seguridad.</p>';
            } else if (percentage >= 70) {
                message = '<p style="margin-top: 20px; font-size: 1.1em; color: #667eea;">¬°Buen trabajo! Tienes un buen conocimiento de seguridad.</p>';
            } else if (percentage >= 50) {
                message = '<p style="margin-top: 20px; font-size: 1.1em; color: #ffc107;">Resultado aceptable. Sigue practicando para mejorar.</p>';
            } else {
                message = '<p style="margin-top: 20px; font-size: 1.1em; color: #dc3545;">Necesitas repasar los conceptos. ¬°No te rindas!</p>';
            }

            details.innerHTML += message;

            // Limpiar progreso guardado
            localStorage.removeItem('quizProgress');
        }

        // Volver al men√∫
        function returnToMenu() {
            // Confirmar si hay progreso sin guardar
            if (userAnswers.length > 0 && userAnswers.length < currentQuestions.length) {
                if (!confirm('¬øEst√°s seguro de que quieres salir? Perder√°s tu progreso actual.')) {
                    return;
                }
            }

            // Resetear todo
            currentMode = null;
            currentQuestions = [];
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            answered = false;
            topicScores = {};

            // Ocultar todo y mostrar men√∫
            document.getElementById('quizContainer').classList.remove('active');
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('modeSelection').style.display = 'block';
            document.getElementById('backToMenu').classList.add('hidden');

            // Desmarcar modo seleccionado
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Deshabilitar bot√≥n de inicio
            document.getElementById('startBtn').disabled = true;

            // Limpiar progreso guardado
            localStorage.removeItem('quizProgress');
        }

        // Repetir el mismo modo
        function restartSameMode() {
            document.getElementById('resultsScreen').style.display = 'none';
            startQuiz();
        }

        // Guardar progreso en localStorage
        function saveProgress() {
            const progress = {
                mode: currentMode,
                currentQuestion: currentQuestion,
                score: score,
                userAnswers: userAnswers,
                questions: currentQuestions,
                topicScores: topicScores
            };
            localStorage.setItem('quizProgress', JSON.stringify(progress));
            
            // Mostrar indicador de guardado
            const indicator = document.getElementById('saveIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        // Cargar progreso guardado
        function loadProgress() {
            const saved = localStorage.getItem('quizProgress');
            if (saved) {
                const progress = JSON.parse(saved);
                if (confirm('Hay un test en progreso. ¬øDeseas continuarlo?')) {
                    currentMode = progress.mode;
                    currentQuestion = progress.currentQuestion;
                    score = progress.score;
                    userAnswers = progress.userAnswers;
                    currentQuestions = progress.questions;
                    topicScores = progress.topicScores || {};
                    
                    // Mostrar el quiz en el estado guardado
                    document.getElementById('modeSelection').style.display = 'none';
                    document.getElementById('quizContainer').classList.add('active');
                    document.getElementById('progressContainer').style.display = 'block';
                    document.getElementById('backToMenu').classList.remove('hidden');
                    
                    loadQuestion();
                    updateProgressBar();
                } else {
                    localStorage.removeItem('quizProgress');
                }
            }
        }

        // Prevenir navegaci√≥n accidental
        window.addEventListener('beforeunload', function (e) {
            if (userAnswers.length > 0 && userAnswers.length < currentQuestions.length && document.getElementById('quizContainer').classList.contains('active')) {
                e.preventDefault();
                e.returnValue = 'Tienes un test en progreso. ¬øEst√°s seguro de que quieres salir?';
            }
        });

        // Cargar progreso al iniciar
        window.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            
            // Recuperar √∫ltimo modo seleccionado
            const lastMode = localStorage.getItem('lastSelectedMode');
            if (lastMode && !currentMode) {
                selectMode(lastMode);
            }
        });
    </script>
</body>

</html>