<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Seguridad y Alta Disponibilidad - Sistema de Evaluaci√≥n Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            font-size: 16px;
        }

        .container {
            width: 100%;
            max-width: 100%;
            height: 100vh;
            margin: 0;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }

        @media (min-width: 768px) {
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 0;
            }
            .container {
                max-width: 900px;
                height: 100vh;
                border-radius: 0;
                box-shadow: 0 0 60px rgba(0,0,0,0.3);
            }
        }

        @media (min-width: 1024px) {
            body { padding: 20px; }
            .container {
                height: calc(100vh - 40px);
                border-radius: 20px;
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .header h1 { font-size: 1.5em; margin-bottom: 8px; }
        @media (min-width: 480px) { .header h1 { font-size: 2em; } }
        @media (min-width: 768px) { .header h1 { font-size: 2.5em; } }

        .progress-container {
            background: rgba(255,255,255,0.2);
            height: 22px;
            border-radius: 15px;
            margin-top: 12px;
            overflow: hidden;
        }

        .progress-bar {
            background: white;
            height: 100%;
            border-radius: 15px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #667eea;
            font-size: 0.8em;
        }

        .mode-selection {
            padding: 20px 15px;
            text-align: center;
            min-height: calc(100vh - 120px);
        }

        .modes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .mode-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            touch-action: manipulation;
        }

        .mode-card:hover { border-color: #667eea; transform: translateY(-2px); }
        .mode-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .mode-icon { font-size: 2em; margin-bottom: 8px; }
        .mode-title { font-size: 1.1em; font-weight: bold; }
        .mode-description { font-size: 0.8em; opacity: 0.9; }

        .quiz-container { padding: 20px 15px; display: none; }
        .quiz-container.active { display: block; animation: slideIn 0.5s ease; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .option.selected { background: #667eea; color: white; }
        .option.correct { background: #28a745; color: white; }
        .option.incorrect { background: #dc3545; color: white; }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            width: 100%;
        }

        .btn-primary { background: #667eea; color: white; }
        .btn-primary:disabled { opacity: 0.5; }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }
        .feedback.show { display: block; }
        .feedback.correct { background: #d4edda; border: 1px solid #28a745; }
        .feedback.incorrect { background: #f8d7da; border: 1px solid #dc3545; }

        .results-screen { padding: 20px; display: none; text-align: center; }
        .back-to-menu {
            position: fixed; top: 10px; left: 10px;
            background: white; border-radius: 50%;
            width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            z-index: 100; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .hidden { display: none; }
    </style>
</head>

<body>
    <div class="back-to-menu hidden" id="backToMenu" onclick="returnToMenu()">‚¨ÖÔ∏è</div>

    <div class="container">
        <div class="header">
            <h1>Seguridad y Alta Disponibilidad</h1>
            <p>Sistema de Evaluaci√≥n Completo</p>
            <div class="progress-container" style="display: none;" id="progressContainer">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
        </div>

        <div class="mode-selection" id="modeSelection">
            <h2>Selecciona el Modo de Pr√°ctica</h2>
            <div class="modes-grid">
                <div class="mode-card" onclick="selectMode('ut1')" id="modeUT1">
                    <div class="mode-icon">üõ°Ô∏è</div>
                    <div class="mode-title">UT-1: Fundamentos</div>
                    <div class="mode-description">Seguridad f√≠sica, l√≥gica, tr√≠ada CID y criptograf√≠a b√°sica.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut2')" id="modeUT2">
                    <div class="mode-icon">üïµÔ∏è</div>
                    <div class="mode-title">UT-2: Amenazas</div>
                    <div class="mode-description">Malware, Cyber Kill Chain y an√°lisis de red.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut3')" id="modeUT3">
                    <div class="mode-icon">üîë</div>
                    <div class="mode-title">UT-3: Accesos</div>
                    <div class="mode-description">VPN, SSH, RADIUS y bastiones.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut4')" id="modeUT4">
                    <div class="mode-icon">üß±</div>
                    <div class="mode-title">UT-4: Per√≠metro</div>
                    <div class="mode-description">Firewalls, DMZ y reglas ACL.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut5')" id="modeUT5">
                    <div class="mode-icon">üîÑ</div>
                    <div class="mode-title">UT-5: Proxies</div>
                    <div class="mode-description">Servidores Proxy y autenticaci√≥n LDAP.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut6')" id="modeUT6">
                    <div class="mode-icon">üîã</div>
                    <div class="mode-title">UT-6: Disponibilidad</div>
                    <div class="mode-description">HA, clusters, RAID y r√©plicas.</div>
                </div>
                <div class="mode-card" onclick="selectMode('ut7')" id="modeUT7">
                    <div class="mode-icon">‚öñÔ∏è</div>
                    <div class="mode-title">UT-7: Normativa</div>
                    <div class="mode-description">RGPD, LOPDGDD y ENS.</div>
                </div>
                <div class="mode-card" onclick="selectMode('general')" id="modeGeneral" style="grid-column: span 1;">
                    <div class="mode-icon">üéØ</div>
                    <div class="mode-title">Examen General</div>
                    <div class="mode-description">Simulacro con preguntas aleatorias de todas las unidades.</div>
                </div>
            </div>
            <button class="btn btn-primary" id="startBtn" onclick="startQuiz()" disabled>Comenzar Test</button>
        </div>

        <div class="quiz-container" id="quizContainer">
            <div id="questionContainer"></div>
            <div class="feedback" id="feedback"></div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn" style="background:#6c757d; color:white;" id="prevBtn" onclick="previousQuestion()">Anterior</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Siguiente</button>
            </div>
        </div>

        <div class="results-screen" id="resultsScreen">
            <h2>¬°Test Completado!</h2>
            <div style="font-size: 3em; color: #667eea; margin: 20px 0;" id="scoreText">0%</div>
            <div id="topicStats" style="text-align: left; margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 10px;"></div>
            <button class="btn btn-primary" onclick="returnToMenu()">Volver al Men√∫</button>
        </div>
    </div>

    <script>
        // Base de datos de preguntas organizadas por unidad
        const questionsDB = {
            ut1: [
                {
                    question: "¬øCu√°les son los tres pilares fundamentales de la seguridad de la informaci√≥n (tr√≠ada CID)?",
                    options: [
                        "Confidencialidad, Integridad, Disponibilidad",
                        "Control, Identificaci√≥n, Defensa",
                        "Cifrado, Identidad, Datos",
                        "Conexi√≥n, Internet, Dispositivos"
                    ],
                    correct: 0,
                    explanation: "La tr√≠ada CID representa Confidencialidad (solo usuarios autorizados acceden), Integridad (datos sin alteraci√≥n) y Disponibilidad (acceso cuando se necesita).",
                    topic: "UT-1: Fundamentos"
                },
                {
                    question: "¬øQu√© tipo de seguridad protege los equipos f√≠sicos y las instalaciones?",
                    options: [
                        "Seguridad l√≥gica",
                        "Seguridad f√≠sica",
                        "Seguridad perimetral",
                        "Seguridad de red"
                    ],
                    correct: 1,
                    explanation: "La seguridad f√≠sica protege el hardware, las instalaciones y el personal contra amenazas f√≠sicas como robo, incendio o acceso no autorizado.",
                    topic: "UT-1: Fundamentos"
                },
                {
                    question: "¬øQu√© algoritmo de cifrado sim√©trico es considerado el est√°ndar actual?",
                    options: [
                        "DES",
                        "RSA",
                        "AES",
                        "MD5"
                    ],
                    correct: 2,
                    explanation: "AES (Advanced Encryption Standard) es el algoritmo de cifrado sim√©trico est√°ndar actual, con claves de 128, 192 o 256 bits.",
                    topic: "UT-1: Fundamentos"
                },
                {
                    question: "¬øCu√°l es la principal diferencia entre cifrado sim√©trico y asim√©trico?",
                    options: [
                        "El sim√©trico es m√°s seguro",
                        "El asim√©trico usa la misma clave para cifrar y descifrar",
                        "El sim√©trico usa una clave, el asim√©trico usa un par de claves",
                        "El asim√©trico es m√°s r√°pido"
                    ],
                    correct: 2,
                    explanation: "El cifrado sim√©trico usa una sola clave compartida, mientras que el asim√©trico utiliza un par de claves (p√∫blica y privada).",
                    topic: "UT-1: Fundamentos"
                },
                {
                    question: "¬øQu√© funci√≥n criptogr√°fica garantiza la integridad de los datos?",
                    options: [
                        "Cifrado sim√©trico",
                        "Firma digital",
                        "Hash",
                        "Certificado digital"
                    ],
                    correct: 2,
                    explanation: "Las funciones hash generan un resumen √∫nico de los datos que permite detectar cualquier modificaci√≥n.",
                    topic: "UT-1: Fundamentos"
                }
            ],

            ut2: [
                {
                    question: "¬øQu√© tipo de malware se replica a s√≠ mismo sin necesidad de un archivo hu√©sped?",
                    options: [
                        "Virus",
                        "Gusano",
                        "Troyano",
                        "Spyware"
                    ],
                    correct: 1,
                    explanation: "Los gusanos son malware autorreplicantes que se propagan por la red sin necesitar un archivo hu√©sped, a diferencia de los virus.",
                    topic: "UT-2: Amenazas"
                },
                {
                    question: "¬øCu√°l es la primera fase del Cyber Kill Chain?",
                    options: [
                        "Weaponizaci√≥n",
                        "Explotaci√≥n",
                        "Reconocimiento",
                        "Instalaci√≥n"
                    ],
                    correct: 2,
                    explanation: "El reconocimiento es la primera fase donde el atacante recopila informaci√≥n sobre el objetivo antes de planificar el ataque.",
                    topic: "UT-2: Amenazas"
                },
                {
                    question: "¬øQu√© tipo de ataque intenta hacer que un servicio no est√© disponible?",
                    options: [
                        "Phishing",
                        "Man-in-the-middle",
                        "DDoS",
                        "SQL Injection"
                    ],
                    correct: 2,
                    explanation: "Los ataques DDoS (Distributed Denial of Service) buscan saturar un servicio para hacerlo inaccesible a usuarios leg√≠timos.",
                    topic: "UT-2: Amenazas"
                },
                {
                    question: "¬øQu√© herramienta se utiliza com√∫nmente para an√°lisis de tr√°fico de red?",
                    options: [
                        "Nmap",
                        "Metasploit",
                        "Wireshark",
                        "John the Ripper"
                    ],
                    correct: 2,
                    explanation: "Wireshark es un analizador de protocolos de red que permite capturar y examinar el tr√°fico en tiempo real.",
                    topic: "UT-2: Amenazas"
                },
                {
                    question: "¬øQu√© tipo de malware cifra los archivos y pide un rescate?",
                    options: [
                        "Adware",
                        "Ransomware",
                        "Rootkit",
                        "Keylogger"
                    ],
                    correct: 1,
                    explanation: "El ransomware cifra los archivos del sistema y exige un pago (rescate) para recuperar el acceso a los datos.",
                    topic: "UT-2: Amenazas"
                }
            ],

            ut3: [
                {
                    question: "¬øQu√© protocolo VPN opera en la capa 3 del modelo OSI?",
                    options: [
                        "PPTP",
                        "L2TP",
                        "IPSec",
                        "SSL/TLS"
                    ],
                    correct: 2,
                    explanation: "IPSec opera en la capa 3 (red) del modelo OSI, proporcionando seguridad a nivel de paquetes IP.",
                    topic: "UT-3: Accesos"
                },
                {
                    question: "¬øQu√© puerto utiliza SSH por defecto?",
                    options: [
                        "21",
                        "22",
                        "23",
                        "25"
                    ],
                    correct: 1,
                    explanation: "SSH (Secure Shell) utiliza el puerto 22 por defecto para conexiones seguras de administraci√≥n remota.",
                    topic: "UT-3: Accesos"
                },
                {
                    question: "¬øQu√© protocolo AAA es m√°s completo y moderno?",
                    options: [
                        "RADIUS",
                        "TACACS+",
                        "Kerberos",
                        "LDAP"
                    ],
                    correct: 1,
                    explanation: "TACACS+ separa autenticaci√≥n, autorizaci√≥n y contabilidad, ofreciendo m√°s granularidad que RADIUS.",
                    topic: "UT-3: Accesos"
                },
                {
                    question: "¬øQu√© es un bastion host?",
                    options: [
                        "Un servidor de respaldo",
                        "Un servidor expuesto que act√∫a como punto de entrada seguro",
                        "Un tipo de firewall",
                        "Un sistema de detecci√≥n de intrusos"
                    ],
                    correct: 1,
                    explanation: "Un bastion host es un servidor fortificado que sirve como √∫nico punto de entrada a una red interna desde Internet.",
                    topic: "UT-3: Accesos"
                },
                {
                    question: "¬øQu√© m√©todo de autenticaci√≥n es considerado m√°s seguro?",
                    options: [
                        "Contrase√±a simple",
                        "Autenticaci√≥n de dos factores",
                        "Pregunta de seguridad",
                        "PIN de 4 d√≠gitos"
                    ],
                    correct: 1,
                    explanation: "La autenticaci√≥n de dos factores (2FA) combina algo que sabes con algo que tienes o eres, aumentando significativamente la seguridad.",
                    topic: "UT-3: Accesos"
                }
            ],

            ut4: [
                {
                    question: "¬øQu√© tipo de firewall inspecciona el estado de las conexiones?",
                    options: [
                        "Packet filtering",
                        "Proxy",
                        "Stateful",
                        "Application"
                    ],
                    correct: 2,
                    explanation: "Los firewalls stateful mantienen una tabla de estado de las conexiones, permitiendo un filtrado m√°s inteligente del tr√°fico.",
                    topic: "UT-4: Per√≠metro"
                },
                {
                    question: "¬øQu√© es una DMZ en seguridad de redes?",
                    options: [
                        "Una zona de alta seguridad",
                        "Una zona intermedia entre la red interna e Internet",
                        "Un tipo de VPN",
                        "Un protocolo de seguridad"
                    ],
                    correct: 1,
                    explanation: "La DMZ (Zona Desmilitarizada) es una red perimetral que a√±ade una capa de seguridad entre Internet y la red interna.",
                    topic: "UT-4: Per√≠metro"
                },
                {
                    question: "¬øCu√°l es la diferencia principal entre IDS e IPS?",
                    options: [
                        "IDS es m√°s r√°pido",
                        "IPS solo detecta, IDS bloquea",
                        "IDS solo detecta, IPS detecta y bloquea",
                        "No hay diferencia"
                    ],
                    correct: 2,
                    explanation: "IDS (Intrusion Detection System) solo detecta y alerta, mientras que IPS (Intrusion Prevention System) puede bloquear activamente las amenazas.",
                    topic: "UT-4: Per√≠metro"
                },
                {
                    question: "¬øQu√© puerto debe estar abierto para permitir tr√°fico HTTPS?",
                    options: [
                        "80",
                        "443",
                        "8080",
                        "8443"
                    ],
                    correct: 1,
                    explanation: "HTTPS utiliza el puerto 443 por defecto para comunicaciones web seguras con cifrado SSL/TLS.",
                    topic: "UT-4: Per√≠metro"
                },
                {
                    question: "¬øQu√© t√©cnica usa pfSense para balancear la carga entre m√∫ltiples enlaces WAN?",
                    options: [
                        "NAT",
                        "Multi-WAN",
                        "VLAN",
                        "Bridge"
                    ],
                    correct: 1,
                    explanation: "pfSense utiliza Multi-WAN para distribuir el tr√°fico entre m√∫ltiples conexiones a Internet, proporcionando balanceo de carga y failover.",
                    topic: "UT-4: Per√≠metro"
                }
            ],

            ut5: [
                {
                    question: "¬øCu√°l es la funci√≥n principal de un proxy HTTP?",
                    options: [
                        "Cifrar todo el tr√°fico de red",
                        "Actuar como intermediario entre clientes y servidores web",
                        "Bloquear todos los virus",
                        "Reemplazar el firewall"
                    ],
                    correct: 1,
                    explanation: "Un proxy HTTP act√∫a como intermediario entre los clientes y los servidores web, pudiendo cachear contenido, filtrar y registrar el tr√°fico.",
                    topic: "UT-5: Proxies"
                },
                {
                    question: "¬øQu√© puerto utiliza Squid por defecto?",
                    options: [
                        "8080",
                        "3128",
                        "8888",
                        "1080"
                    ],
                    correct: 1,
                    explanation: "Squid utiliza el puerto 3128 por defecto para las conexiones de proxy HTTP.",
                    topic: "UT-5: Proxies"
                },
                {
                    question: "¬øQu√© tipo de proxy no requiere configuraci√≥n en el cliente?",
                    options: [
                        "Proxy expl√≠cito",
                        "Proxy SOCKS",
                        "Proxy transparente",
                        "Proxy inverso"
                    ],
                    correct: 2,
                    explanation: "El proxy transparente intercepta el tr√°fico sin necesidad de configuraci√≥n en el cliente, funcionando de forma invisible.",
                    topic: "UT-5: Proxies"
                },
                {
                    question: "¬øQu√© es un proxy inverso (reverse proxy)?",
                    options: [
                        "Un proxy que bloquea todo el tr√°fico",
                        "Un proxy que se sit√∫a delante de los servidores web",
                        "Un proxy que invierte las direcciones IP",
                        "Un proxy que funciona al rev√©s"
                    ],
                    correct: 1,
                    explanation: "Un proxy inverso se sit√∫a delante de uno o m√°s servidores web, distribuyendo las peticiones y ocultando la infraestructura interna.",
                    topic: "UT-5: Proxies"
                },
                {
                    question: "¬øQu√© ventaja ofrece la cach√© de un proxy?",
                    options: [
                        "Mayor seguridad",
                        "Reducci√≥n del ancho de banda y mejora de velocidad",
                        "Cifrado de datos",
                        "Bloqueo de malware"
                    ],
                    correct: 1,
                    explanation: "La cach√© del proxy almacena contenido frecuentemente solicitado, reduciendo el uso de ancho de banda y mejorando la velocidad de acceso.",
                    topic: "UT-5: Proxies"
                }
            ],

            ut6: [
                {
                    question: "¬øQu√© es la alta disponibilidad (HA)?",
                    options: [
                        "Tener servidores muy r√°pidos",
                        "Capacidad de un sistema para operar continuamente sin fallos",
                        "Tener muchos usuarios conectados",
                        "Usar la √∫ltima tecnolog√≠a"
                    ],
                    correct: 1,
                    explanation: "La alta disponibilidad es la capacidad de un sistema para mantenerse operativo durante un alto porcentaje del tiempo, minimizando las interrupciones.",
                    topic: "UT-6: Disponibilidad"
                },
                {
                    question: "¬øQu√© significa un SLA del 99.9%?",
                    options: [
                        "Tiempo de inactividad m√°ximo de 8.76 horas al a√±o",
                        "Tiempo de inactividad m√°ximo de 1 hora al a√±o",
                        "Tiempo de inactividad m√°ximo de 24 horas al a√±o",
                        "Tiempo de inactividad m√°ximo de 1 minuto al a√±o"
                    ],
                    correct: 0,
                    explanation: "Un SLA del 99.9% (tres nueves) permite un tiempo de inactividad m√°ximo de aproximadamente 8.76 horas al a√±o.",
                    topic: "UT-6: Disponibilidad"
                },
                {
                    question: "¬øQu√© es un cl√∫ster activo-pasivo?",
                    options: [
                        "Todos los nodos procesan tr√°fico simult√°neamente",
                        "Un nodo activo procesa mientras otros esperan en standby",
                        "Los nodos se activan por la noche",
                        "Los nodos trabajan en diferentes ubicaciones"
                    ],
                    correct: 1,
                    explanation: "En un cl√∫ster activo-pasivo, un nodo maneja todo el tr√°fico mientras los otros permanecen en espera, listos para tomar el control si falla el activo.",
                    topic: "UT-6: Disponibilidad"
                },
                {
                    question: "¬øQu√© es RAID 5?",
                    options: [
                        "Espejo completo de datos",
                        "Striping sin redundancia",
                        "Striping con paridad distribuida",
                        "Backup en cinta"
                    ],
                    correct: 2,
                    explanation: "RAID 5 distribuye datos y paridad entre m√∫ltiples discos, permitiendo la recuperaci√≥n si falla un disco.",
                    topic: "UT-6: Disponibilidad"
                },
                {
                    question: "¬øQu√© es el balanceo de carga?",
                    options: [
                        "Dividir archivos en partes iguales",
                        "Distribuir el tr√°fico entre m√∫ltiples servidores",
                        "Reducir el peso de los servidores",
                        "Equilibrar el consumo el√©ctrico"
                    ],
                    correct: 1,
                    explanation: "El balanceo de carga distribuye las peticiones entrantes entre m√∫ltiples servidores para optimizar el rendimiento y evitar sobrecarga.",
                    topic: "UT-6: Disponibilidad"
                }
            ],

            ut7: [
                {
                    question: "¬øQu√© es el RGPD?",
                    options: [
                        "Un protocolo de red",
                        "Reglamento General de Protecci√≥n de Datos",
                        "Red General de Prevenci√≥n de Desastres",
                        "Un tipo de firewall"
                    ],
                    correct: 1,
                    explanation: "El RGPD es el Reglamento General de Protecci√≥n de Datos de la UE que regula el tratamiento de datos personales.",
                    topic: "UT-7: Normativa"
                },
                {
                    question: "¬øCu√°l es el plazo m√°ximo para notificar una brecha de seguridad seg√∫n el RGPD?",
                    options: [
                        "24 horas",
                        "48 horas",
                        "72 horas",
                        "7 d√≠as"
                    ],
                    correct: 2,
                    explanation: "El RGPD establece un plazo m√°ximo de 72 horas para notificar una brecha de seguridad a la autoridad de control.",
                    topic: "UT-7: Normativa"
                },
                {
                    question: "¬øQu√© significa ENS en el contexto de seguridad espa√±ola?",
                    options: [
                        "Esquema Nacional de Seguridad",
                        "Empresa Nacional de Software",
                        "Evaluaci√≥n Normal de Sistemas",
                        "Est√°ndar Nacional de Servidores"
                    ],
                    correct: 0,
                    explanation: "El ENS (Esquema Nacional de Seguridad) establece la pol√≠tica de seguridad en el uso de medios electr√≥nicos en las administraciones p√∫blicas.",
                    topic: "UT-7: Normativa"
                },
                {
                    question: "¬øQu√© es un DPO seg√∫n el RGPD?",
                    options: [
                        "Data Protection Officer",
                        "Digital Privacy Organization",
                        "Database Performance Optimizer",
                        "Direct Protocol Operation"
                    ],
                    correct: 0,
                    explanation: "El DPO (Data Protection Officer) o Delegado de Protecci√≥n de Datos es responsable de supervisar el cumplimiento del RGPD en la organizaci√≥n.",
                    topic: "UT-7: Normativa"
                },
                {
                    question: "¬øQu√© principio del RGPD limita la recogida de datos al m√≠nimo necesario?",
                    options: [
                        "Transparencia",
                        "Minimizaci√≥n de datos",
                        "Exactitud",
                        "Limitaci√≥n del plazo"
                    ],
                    correct: 1,
                    explanation: "El principio de minimizaci√≥n de datos establece que solo se deben recoger los datos personales necesarios para los fines espec√≠ficos.",
                    topic: "UT-7: Normativa"
                }
            ]
        };

        // Variables globales
        let currentMode = null;
        let currentQuestions = [];
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = [];
        let answered = false;
        let topicScores = {};

        // Funci√≥n para mezclar arrays
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Seleccionar modo
        function selectMode(mode) {
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });

            const modeCard = document.getElementById('mode' + mode.toUpperCase());
            if (modeCard) {
                modeCard.classList.add('selected');
            }

            currentMode = mode;
            document.getElementById('startBtn').disabled = false;
        }

        // Iniciar quiz
        function startQuiz() {
            if (!currentMode) return;

            // Resetear variables
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            answered = false;
            topicScores = {};

            // Seleccionar preguntas seg√∫n el modo
            if (currentMode === 'general') {
                // Modo general: todas las preguntas mezcladas
                const allQuestions = [];
                Object.values(questionsDB).forEach(unit => {
                    allQuestions.push(...unit);
                });
                currentQuestions = shuffleArray(allQuestions);
            } else {
                // Modo espec√≠fico de unidad
                currentQuestions = shuffleArray(questionsDB[currentMode] || []);
            }

            // Mostrar quiz
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('quizContainer').classList.add('active');
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('backToMenu').classList.remove('hidden');

            // Cargar primera pregunta
            loadQuestion();
            updateProgressBar();
        }

        // Cargar pregunta
        function loadQuestion() {
            answered = userAnswers[currentQuestion] !== undefined;
            const q = currentQuestions[currentQuestion];

            const questionHTML = `
                <h2>Pregunta ${currentQuestion + 1} de ${currentQuestions.length}</h2>
                <p style="color: #6c757d; font-size: 0.9em;">${q.topic}</p>
                <p style="margin: 20px 0; font-size: 1.1em;">${q.question}</p>
                <div id="optionsContainer">
                    ${q.options.map((option, index) => {
                        const isSelected = userAnswers[currentQuestion] === index;
                        const isCorrect = index === q.correct;
                        let className = 'option';
                        
                        if (answered) {
                            if (isSelected) className += ' selected';
                            if (isSelected && !isCorrect) className += ' incorrect';
                            if (isCorrect) className += ' correct';
                        }

                        return `<div class="${className}" onclick="selectOption(${index})">${option}</div>`;
                    }).join('')}
                </div>
            `;

            document.getElementById('questionContainer').innerHTML = questionHTML;

            // Mostrar feedback si ya fue respondida
            if (answered) {
                showFeedback(userAnswers[currentQuestion] === q.correct);
            } else {
                document.getElementById('feedback').classList.remove('show');
            }

            updateButtons();
        }

        // Seleccionar opci√≥n
        function selectOption(index) {
            if (answered) return;

            userAnswers[currentQuestion] = index;
            answered = true;

            const options = document.querySelectorAll('.option');
            options[index].classList.add('selected');

            const correct = currentQuestions[currentQuestion].correct;
            const topic = currentQuestions[currentQuestion].topic;

            // Actualizar estad√≠sticas por tema
            if (!topicScores[topic]) {
                topicScores[topic] = { correct: 0, total: 0 };
            }
            topicScores[topic].total++;

            if (index === correct) {
                options[index].classList.add('correct');
                score++;
                topicScores[topic].correct++;
                showFeedback(true);
            } else {
                options[index].classList.add('incorrect');
                options[correct].classList.add('correct');
                showFeedback(false);
            }

            updateButtons();
        }

        // Mostrar feedback
        function showFeedback(isCorrect) {
            const feedback = document.getElementById('feedback');
            feedback.className = `feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.innerHTML = `
                <strong>${isCorrect ? '‚úÖ ¬°Correcto!' : '‚ùå Incorrecto'}</strong><br>
                ${currentQuestions[currentQuestion].explanation}
            `;
        }

        // Navegar a pregunta anterior
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
                updateProgressBar();
            }
        }

        // Navegar a siguiente pregunta
        function nextQuestion() {
            if (currentQuestion < currentQuestions.length - 1) {
                currentQuestion++;
                loadQuestion();
                updateProgressBar();
            } else if (userAnswers.length === currentQuestions.length) {
                showResults();
            }
        }

        // Actualizar botones
        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            prevBtn.disabled = currentQuestion === 0;

            if (currentQuestion === currentQuestions.length - 1) {
                if (userAnswers.length === currentQuestions.length) {
                    nextBtn.textContent = 'Ver Resultados';
                    nextBtn.disabled = false;
                } else {
                    nextBtn.textContent = 'Siguiente';
                    nextBtn.disabled = !answered;
                }
            } else {
                nextBtn.textContent = 'Siguiente';
                nextBtn.disabled = !answered;
            }
        }

        // Actualizar barra de progreso
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / currentQuestions.length) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }

        // Mostrar resultados
        function showResults() {
            document.getElementById('quizContainer').classList.remove('active');
            document.getElementById('resultsScreen').style.display = 'block';
            document.getElementById('progressContainer').style.display = 'none';

            const percentage = Math.round((score / currentQuestions.length) * 100);
            document.getElementById('scoreText').textContent = percentage + '%';

            // Mostrar estad√≠sticas por tema
            const topicStatsDiv = document.getElementById('topicStats');
            let topicHTML = '<h3>Rendimiento por Tema:</h3>';

            for (const [topic, stats] of Object.entries(topicScores)) {
                const topicPercentage = Math.round((stats.correct / stats.total) * 100);
                topicHTML += `
                    <div style="margin: 10px 0;">
                        <strong>${topic}:</strong> ${stats.correct}/${stats.total} (${topicPercentage}%)
                    </div>
                `;
            }

            // Mensaje seg√∫n el resultado - CORREGIDO
            let message = '';
            if (percentage >= 90) {
                message = '<p style="margin-top: 20px; font-size: 1.1em; color: #28a745;">¬°Excelente! Dominas los conceptos de seguridad.</p>';
            } else if (percentage >= 70) {
                message = '<p style="margin-top: 20px; font-size: 1.1em; color: #667eea;">¬°Buen trabajo! Tienes un buen conocimiento de seguridad.</p>';
            } else if (percentage >= 50) {
                message = '<p style="margin-top: 20px; font-size: 1.1em; color: #ffc107;">Resultado aceptable. Sigue practicando para mejorar.</p>';
            } else {
                message = '<p style="margin-top: 20px; font-size: 1.1em; color: #dc3545;">Necesitas repasar los conceptos. ¬°No te rindas!</p>';
            }

            topicStatsDiv.innerHTML = topicHTML + message;
        }

        // Volver al men√∫
        function returnToMenu() {
            // Resetear todo
            currentMode = null;
            currentQuestions = [];
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            answered = false;
            topicScores = {};

            // Ocultar todo y mostrar men√∫
            document.getElementById('quizContainer').classList.remove('active');
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('modeSelection').style.display = 'block';
            document.getElementById('backToMenu').classList.add('hidden');

            // Desmarcar modo seleccionado
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Deshabilitar bot√≥n de inicio
            document.getElementById('startBtn').disabled = true;
        }

        // Prevenir navegaci√≥n accidental
        window.addEventListener('beforeunload', function (e) {
            if (userAnswers.length > 0 && document.getElementById('quizContainer').classList.contains('active')) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>

</html>